\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sphinxcronologic}
\author{cronologic GmbH \& Co KG}

\RequirePackage{ifthen}
\RequirePackage{xstring}
\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=crono, prefix=crono@}

% options provided with the sphinxcronologic package, e.g.
% \usepackage[font=montserrat]{sphinxcronologic}
\DeclareStringOption[montserrat]{font} % montserrat or fira or default
\ProcessKeyvalOptions{crono}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% colors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\PassOptionsToPackage{usenames,dvipsnames}{xcolor}
\RequirePackage{xcolor}
\definecolor{org}{RGB}{237,120,0}
\definecolor{gry}{RGB}{157,157,156}
\definecolor{crongrey}{gray}{0.5} %Variablendeklaration API
\definecolor{cronorange}{RGB}{237, 120, 0}
\definecolor{cronblue}{RGB}{55, 110, 181}
\definecolor{cronblack}{RGB}{0,0,0}
\definecolor{keywordred}{RGB}{142,33,0}

% Colors used by custom sphinx roles
\renewcommand{\DUrole}[2]{%
	\IfEqCase{#1}{%
		{red}{{\color{keywordred} #2}}%
		{cronoblue}{{\color{cronblue} #2}}%
	}%
}

\RequirePackage{graphicx} %for including figures
\RequirePackage{tabularx}
\RequirePackage{ragged2e} % provide RaggedRight, RaggedLeft
\RequirePackage{tikz} % double line border support
\PassOptionsToPackage{section,subsection,subsubsection}{extraplaceins}
\RequirePackage{extraplaceins} %for binding figures to a (sub-)section
\RequirePackage{array} %for centered AND constant width columns
\RequirePackage{microtype} % better textblock layout

\RequirePackage{caption}
\DeclareCaptionFont{cronocaptionlabelfont}{\bfseries\color{gry}}
\DeclareCaptionFont{cronocaptionfont}{\color{gry}}
\captionsetup{
	labelsep=space,
	labelfont=cronocaptionlabelfont,
	textfont=cronocaptionfont,
}

% \PassOptionsToPackage{footsepline=1pt}{scrlayer-scrpage}
\RequirePackage{makecell}  % multi line table cells
\RequirePackage{incgraph} % to include the title page


%%
% Font setup
%%
\RequirePackage{fontspec}
\RequirePackage{unicode-math}[mathrm=sym,math-style=ISO,bold-style=upright]
\defaultfontfeatures{Scale=MatchLowercase}

\ifthenelse{\equal{\crono@font}{montserrat}}
{
	\setmainfont{Montserrat}
	\setsansfont{Montserrat}
	\setmonofont{Anonymous Pro}
	\newfontfamily\sectionfont{Montserrat}
	\setmathfont{Latin Modern Math}[Scale=MatchUppercase]
	\setmathfont[range=up/{latin,Latin,num},Numbers=Lining]{Montserrat}
	\setmathfont[range=it/{latin,Latin,num},Numbers=Lining]{Montserrat-Italic}
	\setmathfont[range=bfup/{latin,Latin,num},Numbers=Lining]{Montserrat-Bold}
	\setmathfont[range=bfit/{latin,Latin,num},Numbers=Lining]%
		{Montserrat-BoldItalic}
	\setmathfont[range=up/{greek,Greek}]{KerkisSans}
	\setmathfont[range=it/{greek,Greek}]{KerkisSans Italic}
	\setmathfont[range=bfup/{greek,Greek}]{Kerkis Sans Bold}
	\setmathfont[range=bfit/{greek,Greek}]{Kerkis Sans Bold Italic}
}{\relax}

\ifthenelse{\equal{\crono@font}{fira}}
{
	\setmainfont[
		Numbers=Tabular,
		ItalicFont={FiraSans-Italic.otf},
		BoldFont={FiraSans-Bold.otf},
		BoldItalicFont={FiraSans-BoldItalic.otf}
	]{FiraSans-Regular.otf}
	\setsansfont[
		Numbers=Tabular,
		ItalicFont={FiraSans-Italic.otf},
		BoldFont={FiraSans-Bold.otf},
		BoldItalicFont={FiraSans-BoldItalic.otf}
	]{FiraSans-Regular.otf}
	\setmonofont[
		ItalicFont={FiraMono-Oblique.otf},
		BoldFont={FiraMono-Bold.otf},
		BoldItalicFont={FiraMono-BoldOblique.otf}
	]{FiraMono-Regular.otf}
	\newfontfamily\sectionfont
	[
		ItalicFont={Montserrat-Italic.otf},
		BoldFont={Montserrat-Bold.otf},
		BoldItalicFont={Montserrat-BoldItalic.otf}
	]
	{Montserrat-Regular.otf}
	\setmathfont{Fira Math}[Numbers=Tabular]
}{\relax}

\ifthenelse{\equal{\crono@font}{default}}
{
	\newcommand\sectionfont{}
}{\relax}


%%%%%%%%%% Definitions for the whole document 
 
%import a title PDF and create TOC
\newcommand{\cronofront}{
	\thispagestyle{empty}
	\begin{tikzpicture}
	\draw[inner sep=0pt] node at (0,0){
		\includegraphics[width=155mm]{cronologic.pdf}
	};
	\end{tikzpicture}

	\begin{minipage}{0.83\textwidth}
	\begin{tabular}{l}

	\begin{tikzpicture}
	\draw[inner sep=0pt] node at (-8.1,1){\fontsize{20}{2}\selectfont
	\sectionfont 
	{\textcolor{org}{Thunderbolt to PCIe}}};

	\draw[align=center] node at (-8.3,0){\fontsize{20}{2}\selectfont
	\sffamily \textcolor{org}{USER GUIDE}};
	\end{tikzpicture}
	\\ \vspace{5pt}
	%{\efbox{
	%\hspace{-10pt}
	\includegraphics[width=120mm,height=150mm,keepaspectratio]{XHPTDC4-PCIe_032_Front_view.png}
	%}}
	\\
	\end{tabular}
	\end{minipage}
	\begin{minipage}{0\textwidth}
	\vspace{25pt}
	\begin{tikzpicture}
	\draw[inner sep=0pt] node at (0,-5){ 
	\fontsize{80}{2}\selectfont
	\sectionfont 
	\bfseries \textcolor{org}{ \rotatebox{90}{\hspace*{1em}TBT2PCIe\hspace*{1em}}}};
	\end{tikzpicture}
	\end{minipage}

	\vspace{-25pt}
	\begin{minipage}{0\textwidth}
	\begin{tikzpicture}
	\draw[inner sep=0pt] node at (-3,-18){\fontsize{20}{2}\selectfont
	\sffamily \textcolor{gry}{~\url{www.cronologic.de}}};
	\end{tikzpicture}
	\end{minipage}
	\clearpage
}

\PassOptionsToPackage{
	colorlinks=true,
	linkcolor=cronblue,
	urlcolor=gry
}{hyperref}
\RequirePackage{hyperref}

% format headings
\titleformat{\chapter}%
	{\LARGE\sffamily\bfseries\color{cronorange}}%
	{\thechapter}{1em}{}{}
\titlespacing*{\chapter}%
	{0ex}{0ex}{*2}

\titleformat{\section}%
	{\Large\bfseries\sffamily\color{cronorange}}%
	{\thesection}{1em}{}{}

\titleformat{\subsection}%
	{\large\bfseries\sffamily\color{cronblue}}%
	{\thesubsection}{1em}{}{}

\titleformat{\subsubsection}%
	{\bfseries\itshape\sffamily\color{cronblue}}%
	{\thesubsubsection}{1em}{}{}